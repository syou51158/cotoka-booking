## 目的
カード（予約・シフト）を「長押しでドラッグ開始→浮き上がって移動→ドロップで更新」できる操作に再設計し、長押し編集との干渉を解消。座標計算とイベント処理の不具合を直して操作性を改善します。

## 現状の不具合（確認）
- イベント設計が混在：`onMouseDown/onMouseMove/onMouseUp` とカード内オーバーレイのイベントが競合
- 位置計算がカード要素基準で、実コンテナ（タイムテーブル）基準とズレ
- `onMouseUp` 直後に即コミットされ、ドラッグ状態が成立しにくい
- 長押しが `mouseLeave` やドラッグ開始で即キャンセルされ、編集パネルが開かない
- シフト更新APIで `updated_at` 列のスキーマ不整合によりPUT失敗（操作が反映されにくい）

## 採用方針
- イベントは `Pointer Events` に統一（`onPointerDown/Move/Up`）＋ `setPointerCapture`
- 長押し→ドラッグ開始の一貫UX：
  - 500ms長押しで「編集モード」／ドラッグ意図で閾値（数px）超えたら編集タイマーをキャンセルし「移動モード」へ
  - 移動中はカードを「浮き上がり（`z-10 shadow-lg scale-105 cursor-grabbing`）」表示
- 座標計算は常にタイムテーブルコンテナの `getBoundingClientRect()` を使用し、分数→スナップ→時刻へ変換
- ドロップ時のみコミット。移動しない場合は何もしない。API失敗時はトースト＋元位置にロールバック

## 実装修正
1. タイムテーブルコンポーネント
   - 予約・シフトカードのイベントを Pointer に統一
   - `dragging`/`draggingRes` に `active` フラグ、開始分/終了分、アンカー分、閾値を持たせる
   - `onPointerDown`：長押しタイマー開始、アンカー計算は常にコンテナRect基準
   - `onPointerMove`：閾値超えでドラッグへ移行（編集タイマーをキャンセル）、分単位位置更新（スナップ適用）
   - `onPointerUp`：ドラッグ中なら PUT（予約は `/api/admin/reservations/:id`、シフトは `/api/admin/shifts/:id`）を実行、409なら警告
   - 視覚：ドラッグ中はカードを `z-10 shadow-lg scale-105` に
2. 長押し編集
   - 長押し成立（500ms）時のみ編集パネル表示。ドラッグ移行時は必ずキャンセル
   - 編集保存は既存の管理API（予約PUT）に `notes` 等を渡す
3. API修正（シフト）
   - `/api/admin/shifts/[id]/route.ts` の更新時に存在しない `updated_at` を送らないよう修正
   - 予約PUTは既に重複検知済み。409時にUIでロールバック＋メッセージ

## セーフティ＆検証
- 営業時間外・休業日ではドラッグ開始禁止（コンテナがクリックを無視）
- スナップはサイト設定の枠間隔に必ず従う
- デスクトップ・トラックパッド・タッチで実地検証（前日/翌日切替含む）

## 追加UI調整（簡易）
- カード浮き上がり時に半透明背景と影を付け、他カードとの層分離を視覚化
- グリッドは現状の薄い設定を維持（操作時の視線がカードへ向くように）

この計画で改修を進めます。よろしければ実装に入ります。