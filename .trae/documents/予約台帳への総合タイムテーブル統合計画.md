## 目的
管理者の「予約台帳（/admin）」に日次タイムテーブルを統合し、顧客予約・スタッフシフト・休憩を一画面で俯瞰・編集できるようにします。クリック/ドラッグ主体の操作で枠作成・調整を効率化します。

## 現状確認
- 予約台帳（/admin）は一覧・サマリー・フィルタ・CSV出力が中心（`src/app/admin/(protected)/page.tsx`）。
- シフト管理（/admin/shifts）には新たな日次タイムテーブルUIを追加済（クリックで作成）。
- APIは予約取得（`getAdminReservations`）、シフトCRUD（`/api/admin/shifts/*`）、営業時間取得（`/api/admin/schedule/opening-hours`）が揃っています。

## 提案UI（/admin に統合）
- タイムテーブル（日次）を予約一覧の上段に追加。
- カラム：スタッフ別カラム（必要に応じてブース別レーン切替も拡張）。
- ブロック：
  - 顧客予約（色分け：ステータス別）
  - スタッフシフト（通常勤務/休憩は色分け、休憩は note=「休憩」で表現）
  - 営業時間外は背景グレー、休業日は全面「休業」表示。
- フィルタ連動：既存のスタッフ/サービス/ステータス/支払いフィルタを反映。
- 表示日：当日を初期値、日付セレクタで切替。週送りも検討。

## 操作（初期段階）
- クリック→ドラッグで「休憩」または「ブロック（調整枠）」を作成（`POST /api/admin/shifts`、noteに種別）。
- 予約ブロックはクリックで詳細を開く（既存詳細UIへスクロール/展開）。
- 予約とシフトの重なりは警告表示（視覚的な衝突インジケータ）。

## データ連携
- 予約：`getAdminReservations({ from, to, staffId, serviceId, status })` を当日範囲で取得。
- シフト：`GET /api/admin/shifts?week=YYYY-MM-DD&staffId=...` から当日分抽出。
- 営業時間：`GET /api/admin/schedule/opening-hours` を曜日で適用。臨時営業/休業（`getDateOverrides`）は第2段階で反映。

## 表示ルール
- ステータス色分け例：未収=Amber、支払い済=Emerald、キャンセル=Slate、未決済/Pending=Purple。
- 休憩/調整枠：Blue系/Gray系で区別。レジェンドをヘッダー右に表示。
- スナップ：15分（設定で5/10/30分に変更可能）。

## 実装ステップ
1. コンポーネント作成
   - `src/components/admin/reservation-timetable.tsx`（Client）を新規作成。
   - Props: day, staff[], reservations[], shifts[], openingHours。
   - ブロック描画・衝突検知・クリック作成（note="休憩"）を実装。
2. 予約台帳へ組み込み
   - `src/app/admin/(protected)/page.tsx` で当日データ取得を活用し、タイムテーブルを上段にレンダリング。
   - 既存フィルタ値を反映するため、同一検索パラメータをタイムテーブルにも適用。
3. 検証
   - 当日/他日切替、フィルタ連動、休憩作成・削除、重なり警告表示。
   - アクセシビリティ（キーボード操作）とモバイルタッチ操作の確認。

## 第2段階（拡張）
- ドラッグ移動・上下リサイズで予約ブロック/シフトの時間調整（予約は警告のみ、編集は詳細UIからor専用API）。
- 臨時営業/休業の背景表示、ブース別レーン切替、ズーム（5/10/15/30分）。
- 印刷・CSV/ICS出力のタイムテーブル対応。

この方針で「予約台帳への総合タイムテーブル」統合に着手してよろしいでしょうか？